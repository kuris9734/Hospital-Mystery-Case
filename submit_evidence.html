<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æäº¤è¯æ® - åŸéƒŠåŒ»é™¢è°œæ¡ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
        }
        
        .file-dialog {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-button {
            background: rgba(100, 200, 255, 0.2);
            border: 2px dashed rgba(100, 200, 255, 0.5);
            transition: all 0.3s ease;
        }
        
        .file-input-button:hover {
            background: rgba(100, 200, 255, 0.3);
            border-color: rgba(100, 200, 255, 0.8);
        }
        
        .file-preview {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="text-white">
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="file-dialog rounded-xl p-8 max-w-2xl w-full">
            <h2 class="text-2xl font-bold mb-6 text-center">é€‰æ‹©è¦æäº¤çš„è¯æ®æ–‡ä»¶</h2>
            
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">è¯·ä»æ‚¨çš„ç”µè„‘ä¸­é€‰æ‹©è¯æ®æ–‡ä»¶ï¼ˆ.txtæ ¼å¼ï¼‰</label>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" class="file-input" accept=".txt" onchange="handleFileSelect(event)">
                    <div class="file-input-button p-8 rounded-lg text-center cursor-pointer">
                        <div class="text-4xl mb-2">ğŸ“</div>
                        <div class="text-lg font-medium">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
                        <div class="text-sm text-gray-400 mt-1">æ”¯æŒ .txt æ ¼å¼</div>
                    </div>
                </div>
            </div>
            
            <div id="fileInfo" class="hidden mb-4">
                <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold" id="fileName"></span>
                        <span class="text-xs text-gray-400" id="fileSize"></span>
                    </div>
                    <button onclick="viewFileContent()" class="text-sm text-blue-400 hover:text-blue-300 mt-2">
                        æŸ¥çœ‹æ–‡ä»¶å†…å®¹
                    </button>
                </div>
            </div>
            
            <div id="filePreview" class="hidden mb-4">
                <div class="file-preview rounded-lg p-4 text-sm">
                    <div class="text-xs text-gray-400 mb-2">æ–‡ä»¶å†…å®¹é¢„è§ˆï¼š</div>
                    <pre id="fileContent" class="whitespace-pre-wrap text-xs"></pre>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button onclick="cancelSubmit()" class="bg-gray-600 hover:bg-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">
                    å–æ¶ˆ
                </button>
                <button id="submitBtn" onclick="submitFile()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    æäº¤
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let fileContent = '';
        
        // æ­£ç¡®çš„è¯æ®æ–‡ä»¶å†…å®¹
        const correctEvidenceContent = `åŸéƒŠåŒ»é™¢éæ³•å®éªŒè¯æ®
            
å…³é”®è¯æ®ï¼š
1. äººä½“å®éªŒæ—¥å¿— - è¯æ˜éæ³•å®éªŒå­˜åœ¨
2. æ‚£è€…åå• - å¤šåå—å®³è€…ä¿¡æ¯
3. æ‰¹å‡†æ–‡ä»¶ - ä¼ªé€ çš„åˆæ³•æ©æŠ¤
4. ç ”ç©¶ç¬”è®° - é™ˆé™¢é•¿çš„çŠ¯ç½ªæ„å›¾
5. å¤±è¸ªæŠ¥å‘Š - å©·æŠ¤å£«å¤±è¸ªçœŸç›¸

ç»“è®ºï¼šé™ˆæ©˜å­é™¢é•¿ç»„ç»‡éæ³•è¯ç‰©å®éªŒï¼Œå©·æŠ¤å£«è¯•å›¾ä¸¾æŠ¥çœŸç›¸åè¢«ç­å£ã€‚
            `;
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            if (!file.name.endsWith('.txt')) {
                alert('è¯·é€‰æ‹© .txt æ ¼å¼çš„æ–‡ä»¶');
                event.target.value = '';
                return;
            }
            
            selectedFile = file;
            
            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = `å¤§å°: ${(file.size / 1024).toFixed(2)} KB`;
            document.getElementById('fileInfo').classList.remove('hidden');
            document.getElementById('filePreview').classList.add('hidden');
            
            // è¯»å–æ–‡ä»¶å†…å®¹
            const reader = new FileReader();
            reader.onload = function(e) {
                fileContent = e.target.result;
            };
            reader.readAsText(file, 'UTF-8');
            
            // å¯ç”¨æäº¤æŒ‰é’®
            document.getElementById('submitBtn').disabled = false;
        }
        
        function viewFileContent() {
            const previewDiv = document.getElementById('filePreview');
            const contentDiv = document.getElementById('fileContent');
            
            if (previewDiv.classList.contains('hidden')) {
                contentDiv.textContent = fileContent;
                previewDiv.classList.remove('hidden');
            } else {
                previewDiv.classList.add('hidden');
            }
        }
        
        function normalizeText(text) {
            // æ ‡å‡†åŒ–æ–‡æœ¬ï¼šç§»é™¤å¤šä½™ç©ºæ ¼ã€æ¢è¡Œç¬¦ç­‰
            return text.trim().replace(/\s+/g, ' ').replace(/\n+/g, '\n');
        }
        
        function submitFile() {
            if (!selectedFile || !fileContent) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶');
                return;
            }
            
            // æ ‡å‡†åŒ–æ¯”è¾ƒ
            const normalizedFileContent = normalizeText(fileContent);
            const normalizedCorrectContent = normalizeText(correctEvidenceContent);
            
            if (normalizedFileContent === normalizedCorrectContent) {
                // å†…å®¹ä¸€è‡´ï¼Œè§¦å‘é€šå…³
                // é€šçŸ¥æ‰€æœ‰ç›¸å…³çª—å£å…³é—­å¹¶è¿”å›ä¸»èœå•
                closeAllWindowsAndReturnToMenu(true);
            } else {
                // å†…å®¹ä¸ä¸€è‡´ï¼Œæ˜¾ç¤ºå¤±è´¥æ¶ˆæ¯
                showFailureMessage();
            }
        }
        
        function showFailureMessage() {
            // åˆ›å»ºå¤±è´¥æ¶ˆæ¯æ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-gray-900 p-8 rounded-xl border border-red-700 max-w-md w-full mx-4 text-center">
                    <div class="text-4xl mb-4">âš ï¸</div>
                    <h3 class="text-2xl font-bold mb-4 text-red-400">æäº¤å¤±è´¥</h3>
                    <p class="text-lg mb-6 leading-relaxed">
                        ä½ æ²¡èƒ½æäº¤æœ‰åˆ©è¯æ®ï¼Œåœ¨è°ƒæŸ¥æœŸé—´é™ˆæ©˜å­æ½œé€ƒäº†ã€‚
                    </p>
                    <button onclick="closeAllWindowsAndReturnToMenu(false)" class="bg-gray-600 hover:bg-gray-700 px-6 py-3 rounded-lg font-medium transition-colors">
                        ç¡®å®š
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeAllWindowsAndReturnToMenu(success) {
            // é€šçŸ¥çˆ¶çª—å£ï¼ˆexperiment_clues.htmlï¼‰
            if (window.opener) {
                window.opener.postMessage({ 
                    type: 'closeAllAndReturnToMenu', 
                    success: success 
                }, '*');
            }
            
            // å¦‚æœæ˜¯æˆåŠŸï¼Œæ‰“å¼€é€šå…³ç”»é¢
            if (success) {
                // æ‰“å¼€é€šå…³ç”»é¢ï¼ˆå®ƒä¼šè‡ªå·±å¤„ç†å…³é—­å’Œè¿”å›ä¸»èœå•ï¼‰
                window.location.href = 'ending.html';
            } else {
                // å¤±è´¥ï¼Œç›´æ¥å…³é—­å½“å‰çª—å£
                window.close();
            }
        }
        
        function cancelSubmit() {
            window.close();
        }
    </script>
</body>
</html>
